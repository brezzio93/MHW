<!-- Mission Select -->
<dx-select-box
    [items]="missionList"
    valueExpr="id"
    fieldTemplate="field"
    label="Choose Quest"
    labelMode="floating"
    (onValueChanged)="selectQuest($event.value)"
    >
    <div *dxTemplate="let data of 'field'">
        <div class="custom-item">
            <img alt="" src="{{ data && data.icon }}" style="height: 50px" />
            <dx-text-box
                class="text"
                [value]="data && data.difficulty"
                [inputAttr]="{ 'aria-label': 'Name' }"
                [readOnly]="true"
            ></dx-text-box>
        </div>
    </div>
    <div *dxTemplate="let data of 'item'">
        <div class="custom-item">
            <img alt="" src="{{ data && data.icon }}" style="height: 50px" />
            <div class="text"> {{ data.difficulty }} </div>
        </div>
    </div>
</dx-select-box>

<!-- Quest -->
@if (!showTrackTokens) {
    <!-- Choose Starting Point -->
    @if(node == undefined) {
        @if(startingPoint.length != 0) {
            <h4>Set Starting point</h4>
        }
        @for(i of startingPoint; track i) {
        <div class="questNode" style="border-width: 2px; border-color:#7f7f7f" (click)="selectStartingNode(i)">
            <div class="titleNode">
                <div style="position: absolute; left: 3rem;">
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 1 > quest[i - 1].potions}" style="height: 30px" />
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 2 > quest[i - 1].potions}" style="height: 30px" />
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 3 > quest[i - 1].potions}" style="height: 30px" />
                </div>
                <span> {{ i }} </span>
                
            </div>
            <div class="textNode">
                <span> {{ quest[i - 1].text }} </span>
                @if(quest[i - 1].action != undefined) {
                    <div style="text-align: center;">
                        <br>
                        <span style="white-space: pre-wrap;" [innerHTML]="quest[i - 1].action"> </span>
                    </div>
                }
            </div>
        
            <div>
                @for(option of quest[i-1].options; track option){
                    <div class="startingOptionNode">
                        <span style="white-space: pre-wrap;" [innerHTML]="option.text"> </span>
                    </div>
                }
            </div>
        </div>
        }
    }
    
    <!-- Node -->
    @if(node != undefined){
        <div class="questNode">
            <div class="titleNode">
                <div style="position: absolute; left: 3rem;">
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 1 > potions}" style="height: 30px" />
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 2 > potions}" style="height: 30px" />
                    <img alt="" src="assets/icons/potion.png" [ngClass]="{'obscured': 3 > potions}" style="height: 30px" />
                </div>                
                <span> {{ node.id }} </span>
            </div>

            <div class="textNode">
                <span> {{ node.text }} </span>
                @if(node.action != undefined) {
                    <div style="text-align: center;">
                        <br>
                        <span [innerHTML]="node.action"> </span>
                    </div>
                }
            </div>

            <div>
                @for(option of node.options; track option) {
                    <div class="optionNode" [ngClass]="{'disabled':option.disabled?.disabled}" (click)="selectNode(option)">
                        <span style="white-space: pre-wrap;" [innerHTML]="option.text"> </span>
                    </div>
                }
            </div>        
        </div>
    }
}
@if (showTrackTokens) {
    <h2> Track Tokens: {{trackTokens}} </h2>
    <hr>
    <h2> Materiales Obtenidos: </h2>
    <dx-data-grid
        [dataSource]="gainedMaterials"
    >
    </dx-data-grid>
}
